<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie Mania</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
    <nav class="navbar">
        <a href="/" class="navbutton active">All Movies</a>
        <a href="/add" class="navbutton">Add Movie</a>
        <a href="/search" class="navbutton">Search</a>
        {% if session.username %}
        <div class="dropdown">
            <button class="dropbtn">{{ session.username }}</button>
            <div class="dropdown-content">
                <a href="/dashboard">Dashboard</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
        {% else %}
        <a href="/login" class="navbutton">Login</a>
        {% endif %}
    </nav>

    <header>
        <h1>Welcome to Movie Mania</h1>
        <p>Your personal movie tracking companion</p>
    </header>

    <main>
        {% with messages = get_flashed_messages() %} {% if messages %}
        <div class="flash-messages">
            {% for message in messages %}
            <div class="flash-message error">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        
        {% if session.username and movies %}
        <header>
            <h1>Movie Mania's Collection üé¨</h1>
            <p>We have {{ pagination.total_items }} in our collection</p>
            <p>Check out your <a href="/dashboard">personal collection</a></p>
        </header>

        <div class="movies-overview-grid">
            {% for movie in movies %}
            <div class="movie-overview-card" onclick="window.location.href='/movie/{{ movie.id }}'">
                <div class="movie-poster-mini">üé¨</div>

                <div class="movie-overview-info">
                    <h3>{{ movie.title }}</h3>

                    <div class="movie-overview-meta">
                        {% if movie.year %}
                        <span class="meta-item year">{{ movie.year }}</span>
                        {% endif %} 
                        {% if movie.category_name %}
                        <span class="meta-item genre">{{ movie.category_name.title() }}</span>
                        {% endif %}
                    </div>

                    {% if movie.rating %}
                    <div class="rating-mini">
                        <span class="rating-stars">
                            {% set rating_int = (movie.rating | int) %}
                            {% set rating_frac = (movie.rating % 1) %}
                            {% for i in range(1, 6) %} 
                            {% if i <= rating_int %} 
                            ‚≠ê 
                            {% elif i == (rating_int + 1) and rating_frac >= 0.5 %} 
                            ‚≠ê 
                            {% else %} 
                            ‚òÜ
                            {% endif %} 
                            {% endfor %}
                        </span>
                        <span class="rating-value">{{ movie.rating }}/5</span>
                        <span class="rating-count">({{ movie.total_ratings }} votes)</span>
                    </div>
                    {% else %}
                    <div class="rating-mini">
                        <span class="rating-value">No ratings</span>
                    </div>
                    {% endif %}

                    <div class="movie-quick-badges">
                        {% if movie.is_favorite %}
                        <span class="quick-badge favorite">üíñ</span>
                        {% endif %} {% if movie.rewatchable %}
                        <span class="quick-badge rewatchable">üîÑ</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination Controls -->
        {% if pagination and pagination.total_pages > 1 %}
        <div class="pagination">
            <div class="pagination-info">
                Sivu {{ pagination.current_page }} / {{ pagination.total_pages }} 
                ({{ pagination.total_items }} elokuvaa yhteens√§)
            </div>
            <div class="pagination-controls">
                {% if pagination.has_prev %}
                <a href="/?page={{ pagination.prev_page }}" class="pagination-btn prev">‚Üê Previous</a>
                {% else %}
                <span class="pagination-btn prev disabled">‚Üê Previous</span>
                {% endif %}

                <div class="pagination-numbers">
                    {% for page_num in range(max(1, pagination.current_page - 2), min(pagination.total_pages + 1, pagination.current_page + 3)) %}
                        {% if page_num == pagination.current_page %}
                        <span class="pagination-number active">{{ page_num }}</span>
                        {% else %}
                        <a href="/?page={{ page_num }}" class="pagination-number">{{ page_num }}</a>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if pagination.has_next %}
                <a href="/?page={{ pagination.next_page }}" class="pagination-btn next">Next ‚Üí</a>
                {% else %}
                <span class="pagination-btn next disabled">Next ‚Üí</span>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% elif session.username %}
        <header>
            <h1>Your Movie Journey Starts Here! üåü</h1>
            <p>Ready to track your favorite films?</p>
        </header>

        <div class="empty-movie-state">
            <div class="empty-illustration">üé≠</div>
            <h3>No movies yet!</h3>
            <p>Start building your personal movie collection by adding your first film.</p>
            <a href="/add" class="btn-primary">Add Your First Movie</a>
        </div>

        {% else %}
        <div class="welcome-content">
            <div class="feature-cards">
                <div class="feature-card">
                    <h3>üìö Track Movies</h3>
                    <p>
                        Keep a record of all the movies you've watched with detailed information and personal
                        ratings.
                    </p>
                </div>
                <div class="feature-card">
                    <h3>‚≠ê Rate & Review</h3>
                    <p>Rate your movies and write reviews to remember what you thought about each film.</p>
                </div>
                <div class="feature-card">
                    <h3>üîç Search & Discover</h3>
                    <p>Easily find movies in your collection and discover new films to watch.</p>
                </div>
            </div>

            <div class="quick-actions">
                <h3>Get Started</h3>
                <div class="action-buttons">
                    {% if session.username %}
                    <a href="/add" class="btn-primary">Add Your First Movie</a>
                    {% endif %}
                    <a href="/register" class="btn-secondary">Create Account</a>
                </div>
            </div>
        </div>
        {% endif %}
    </main>
</body>

</html>
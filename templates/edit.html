<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit {{ movie.title }} - Movie Mania</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
    <nav class="navbar">
        <a href="/" class="navbutton">All Movies</a>
        <a href="/add" class="navbutton">Add Movie</a>
        <a href="/search" class="navbutton">Search</a>
        {% if session.username %}
        <a href="/favorites" class="navbutton">Favorites</a>
        {% endif %}
        {% if session.username %}
        <div class="dropdown">
            <button class="dropbtn">{{ session.username }}</button>
            <div class="dropdown-content">
                <a href="/dashboard">Dashboard</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
        {% else %}
        <a href="/login" class="navbutton">Login</a>
        {% endif %}
    </nav>

    <header>
        <h1>Edit My Rating</h1>
        <p>Update your rating for "{{ movie.title }}"</p>
    </header>

    <main>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="flash-messages">
            {% for message in messages %}
            <div class="flash-message error">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        
        <form id="editMovieForm" class="add-movie-form" method="POST" action="{% if request.endpoint == 'edit' %}/edit/{{ movie.id }}{% else %}/add-review/{{ movie.id }}{% endif %}">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" required />

            <div class="form-section">
                <h3>Movie Information
</h3>
                <div class="form-group">
                    <label>Movie Title</label>
                    <div class="form-static-value">{{ movie.title }}</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Release Year</label>
                        <div class="form-static-value">{{ movie.year or 'Unknown' }}</div>
                    </div>

                    <div class="form-group">
                        <label>Duration</label>
                        <div class="form-static-value">{{ movie.duration or 'Unknown' }} min</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Director</label>
                        <div class="form-static-value">{{ movie.director or 'Unknown' }}</div>
                    </div>

                    <div class="form-group">
                        <label>Category</label>
                        <div class="form-static-value">{{ movie.genre or 'Unknown' }}</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>My Viewing Details</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="watchDate">Watch Date</label>
                        <input type="date" id="watchDate" name="watchDate" value="{% if movie.watch_date %}{{ movie.watch_date if movie.watch_date is string else movie.watch_date.strftime('%Y-%m-%d') if movie.watch_date else '' }}{% endif %}" />
                    </div>

                    <div class="form-group">
                        <label for="rating">My Rating (1-5) *</label>
                        <input type="number" id="rating" name="rating" value="{{ movie.user_rating or '' }}" min="1"
                            max="5" step="0.1" placeholder="5" required />
                    </div>
                </div>

                <div class="form-group">
                    <label for="watchedWith">Watched With</label>
                    <input type="text" id="watchedWith" name="watchedWith" value="{{ movie.watched_with or '' }}"
                        placeholder="e.g. Family, Friends, Alone" />
                </div>
                <div class="form-group">
                    <label for="review">My Review</label>
                    <textarea id="review" name="review" rows="4" placeholder="Write your review here...">{{ movie.review or '' }}</textarea>
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="favorite" name="favorite" {% if movie.is_favorite %}checked{% endif %} />
                    <label for="favorite">Mark as Favorite ‚≠ê</label>
                </div>
            </div>

            <div class="form-actions">
                <a href="/movie/{{ movie.id }}" class="btn-secondary">Cancel</a>
                <button type="submit" class="btn-primary">Save My Rating</button>
            </div>
        </form>
    </main>
</body>

</html>
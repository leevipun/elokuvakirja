<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ movie.title }} - Movie Mania</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    </head>
    <body>
        <nav class="navbar">
            <a href="/" class="navbutton">All Movies</a>
            <a href="/add" class="navbutton">Add Movie</a>
            <a href="/search" class="navbutton">Search</a>
            {% if session.username %}
            <div class="dropdown">
                <button class="dropbtn">{{ session.username }}</button>
                <div class="dropdown-content">
                    <a href="/dashboard">Dashboard</a>
                    <a href="/logout">Logout</a>
                </div>
            </div>
            {% else %}
            <a href="/login" class="navbutton">Login</a>
            {% endif %}
        </nav>

        <main class="movie-detail-main">
            <div class="movie-hero">
                <div class="movie-poster-placeholder">üé¨</div>

                <div class="movie-info">
                    <div class="movie-title-section">
                        <h1>{{ movie.title }}</h1>
                        {% if movie.year %}
                        <span class="movie-year-badge">{{ movie.year }}</span>
                        {% endif %}
                    </div>

                    <div class="movie-rating-section">
                        {% if movie.rating %}
                        <div class="rating-display">
                            <div class="stars">
                                {% for i in range(1, 6) %} 
                                {% if i <= (movie.rating | int) %}
                                <span class="star filled">‚≠ê</span>
                                {% elif i == ((movie.rating | int) + 1) and (movie.rating % 1) >= 0.5 %}
                                <span class="star half">‚≠ê</span>
                                {% else %}
                                <span class="star empty">‚òÜ</span>
                                {% endif %} 
                                {% endfor %}
                            </div>
                            <span class="rating-number">{{ movie.rating }}/5</span>
                            <span class="rating-count">({{ movie.total_ratings }} ratings)</span>
                        </div>
                        {% else %}
                        <div class="rating-display">
                            <span class="rating-number">No ratings yet</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="movie-badges">
                        {% if movie.genre %}
                        <span class="badge genre-badge">{{ movie.genre.title() }}</span>
                        {% endif %} 
                        {% if movie.duration %}
                        <span class="badge duration-badge">{{ movie.duration }} min</span>
                        {% endif %} 
                        {% if movie.is_favorite %}
                        <span class="badge favorite-badge">‚≠ê Favorite</span>
                        {% endif %} 
                        {% if movie.rewatchable %}
                        <span class="badge rewatchable-badge">üîÑ Rewatchable</span>
                        {% endif %}
                    </div>
                </div>

                {% if session.username %}
                <div class="movie-actions-hero">
                    {% if movie.user_rating %}
                    <button class="btn-edit" onclick="window.location.href='/edit/{{ movie.id }}'">
                        Edit My Rating
                    </button>
                    {% if movie.owner_id == session.get('user_id') %}
                    <form method="POST" action="/delete/{{ movie.id }}">
                        <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token') }}">
                        <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this movie?')">
                            Delete Movie
                        </button>
                    </form>
                    {% endif %}
                    {% else %}
                    <button class="btn-add" onclick="window.location.href='/add-review/{{ movie.id }}'">
                        Add My Review
                    </button>
                    {% endif %}
                    <button class="btn-favorite" id="favoriteBtn">
                        {% if movie.is_favorite %} üíñ Remove from Favorites {% else %} ü§ç Add to Favorites {% endif %}
                    </button>
                </div>
                {% endif %}
            </div>

            <div class="movie-details-grid">
                <div class="detail-card">
                    <h3>üé≠ Movie Details</h3>
                    <div class="detail-list">
                        {% if movie.director %}
                        <div class="detail-item">
                            <span class="detail-label">Director:</span>
                            <span class="detail-value">{{ movie.director }}</span>
                        </div>
                        {% endif %} 
                        {% if movie.platform %}
                        <div class="detail-item">
                            <span class="detail-label">Platform:</span>
                            <span class="detail-value platform-{{ movie.platform }}">{{ movie.platform.title() }}</span>
                        </div>
                        {% endif %} 
                        {% if movie.watch_date %}
                        <div class="detail-item">
                            <span class="detail-label">My Watch Date:</span>
                            <span class="detail-value">{{ movie.watch_date }}</span>
                        </div>
                        {% endif %} 
                        {% if movie.watched_with %}
                        <div class="detail-item">
                            <span class="detail-label">Watched With:</span>
                            <span class="detail-value">{{ movie.watched_with }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if movie.review %}
                <div class="detail-card review-card">
                    <h3>üìù General Review</h3>
                    <div class="review-content">
                        <p>{{ movie.review }}</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="movie-meta-footer">
                <small>First added on {{ movie.created_at if movie.created_at else 'Unknown date' }}</small>
            </div>
        </main>
    </body>
</html>
